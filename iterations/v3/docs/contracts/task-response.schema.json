{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://agent-agency/v3/contracts/task-response.schema.json",
  "title": "TaskResponse",
  "description": "Response from task execution with status and tracking information",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Contract version for compatibility"
    },
    "task_id": {
      "type": "string",
      "format": "uuid",
      "description": "Task identifier"
    },
    "status": {
      "type": "string",
      "enum": [
        "accepted",
        "planning",
        "executing",
        "reviewing",
        "refining",
        "completed",
        "failed",
        "cancelled"
      ],
      "description": "Current task execution status"
    },
    "working_spec": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {"type": "string", "format": "uuid"},
        "title": {"type": "string"},
        "description": {"type": "string"},
        "goals": {
          "type": "array",
          "items": {"type": "string"}
        },
        "constraints": {
          "type": "object",
          "additionalProperties": true
        },
        "acceptance_criteria": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "id": {"type": "string"},
              "given": {"type": "string"},
              "when": {"type": "string"},
              "then": {"type": "string"}
            },
            "required": ["id", "given", "when", "then"]
          }
        },
        "test_plan": {
          "type": "object",
          "additionalProperties": true
        },
        "rollback_plan": {
          "type": "object",
          "additionalProperties": true
        },
        "risk_tier": {"type": "integer", "minimum": 1, "maximum": 3}
      },
      "description": "Generated working specification"
    },
    "tracking_url": {
      "type": "string",
      "format": "uri",
      "description": "URL for real-time task progress tracking"
    },
    "estimated_completion": {
      "type": "string",
      "format": "date-time",
      "description": "Estimated completion timestamp"
    },
    "progress": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "current_phase": {"type": "string"},
        "phase_progress": {"type": "number", "minimum": 0, "maximum": 1},
        "overall_progress": {"type": "number", "minimum": 0, "maximum": 1},
        "current_iteration": {"type": "integer", "minimum": 1},
        "max_iterations": {"type": "integer", "minimum": 1},
        "quality_score": {"type": "number", "minimum": 0, "maximum": 1},
        "gates_passed": {"type": "integer", "minimum": 0},
        "gates_total": {"type": "integer", "minimum": 0}
      },
      "description": "Current execution progress"
    },
    "error": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "code": {"type": "string"},
        "message": {"type": "string"},
        "details": {"type": "object", "additionalProperties": true},
        "retryable": {"type": "boolean"}
      },
      "required": ["code", "message"],
      "description": "Error information if task failed"
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "created_at": {"type": "string", "format": "date-time"},
        "started_at": {"type": "string", "format": "date-time"},
        "completed_at": {"type": "string", "format": "date-time"},
        "total_duration_seconds": {"type": "number"},
        "worker_assigned": {"type": "string"},
        "council_reviews": {"type": "integer", "minimum": 0}
      },
      "description": "Execution metadata"
    }
  },
  "required": ["version", "task_id", "status"]
}
