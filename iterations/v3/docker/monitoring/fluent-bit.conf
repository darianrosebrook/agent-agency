# Fluent Bit configuration for Agent Agency logging

[SERVICE]
    Flush         5
    Log_Level     info
    Daemon        off
    Parsers_File  parsers.conf

[INPUT]
    Name              tail
    Path              /var/log/containers/*agent-agency*.log
    Parser            docker
    Tag               docker.agent-agency.*
    Refresh_Interval  5
    Rotate_Wait       5
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On

[INPUT]
    Name              tail
    Path              /app/logs/*.log
    Parser            json
    Tag               agent-agency.application.*
    Refresh_Interval  5
    Mem_Buf_Limit     10MB

[FILTER]
    Name                grep
    Match               docker.agent-agency.*
    Regex               log (ERROR|WARN|INFO)

[FILTER]
    Name                record_modifier
    Match               *
    Record              service_name agent-agency
    Record              environment production

[OUTPUT]
    Name                stdout
    Match               *
    Format              json_lines

[OUTPUT]
    Name                elasticsearch
    Match               docker.agent-agency.*
    Host                elasticsearch
    Port                9200
    Index               agent-agency-docker-%Y.%m.%d
    Type                _doc
    Logstash_Format     On
    Logstash_Prefix     agent-agency
    Retry_Limit         3
    Buffer_Size         10MB

[OUTPUT]
    Name                elasticsearch
    Match               agent-agency.application.*
    Host                elasticsearch
    Port                9200
    Index               agent-agency-app-%Y.%m.%d
    Type                _doc
    Logstash_Format     On
    Logstash_Prefix     agent-agency
    Retry_Limit         3
    Buffer_Size         10MB
